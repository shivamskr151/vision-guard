generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model AnomalyEvent {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  timestamp   DateTime
  severity    String
  type        String
  description String
  assetId     String
  location    String
  confidence  Float
  isResolved  Boolean  @default(false)
  createdAt   DateTime @default(now())
}

model Asset {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  assetId     String   @unique
  name        String
  type        String
  zone        String
  healthStatus String // 'good' | 'warning' | 'critical'
  linkedCameras Int      @default(0)
  criticality Int
  criticalityMax Int     @default(10)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  inspections Inspection[]
  assignedTemplates InspectionTemplate[] @relation(fields: [assignedTemplateIds], references: [id])
  assignedTemplateIds String[] @db.ObjectId
  customData  Json?
  lastInspectionDate DateTime?
  inspectionFrequency Int?
  x           Float    @default(0)
  y           Float    @default(0)
  telemetry   AssetTelemetry[]
}

model SchemaLibrary {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  fieldCount  Int
  tags        String[]
  created     String   // Keeping as string to match mock for now, or could parse to DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  fields      CustomField[]
}

model CustomField {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  label       String
  type        String
  required    Boolean
  options     String[]
  schemaId    String?  @db.ObjectId
  schema      SchemaLibrary? @relation(fields: [schemaId], references: [id])
  createdAt   DateTime @default(now())
}

model InspectionTemplate {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  title           String
  description     String
  questionCount   Int
  durationMinutes Int
  tags            String[]
  frequencyDays   Int
  mandatoryChecks Int
  mandatoryTotal  Int
  created         String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  checklist       InspectionChecklist[]
  assets          Asset[]  @relation(fields: [assetIds], references: [id])
  assetIds        String[] @db.ObjectId
}

model InspectionChecklist {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  text              String
  mandatory         Boolean
  passFailCondition Boolean
  templateId        String   @db.ObjectId
  template          InspectionTemplate @relation(fields: [templateId], references: [id])
}

model Inspection {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  assetId         String
  asset           Asset    @relation(fields: [assetId], references: [assetId])
  inspectorId     String?
  type            String   @default("Routine") // Newly added field
  status          String   // 'scheduled' | 'in-progress' | 'completed' | 'overdue' | 'missed'
  result          String?  // 'pass' | 'fail' | 'warning'
  scheduledDate   DateTime
  completedDate   DateTime?
  durationSeconds Int?
  notes           String?
  checklistData   Json?    // Stores the filled checklist
  defects         Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Zone {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  zoneId      String   @unique
  label       String
  x           Float
  y           Float
  width       Float
  height      Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AssetTelemetry {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  timestamp   DateTime
  assetId     String
  asset       Asset    @relation(fields: [assetId], references: [assetId])

  assetInspection Int?
  assetOverdue    Int?
  activeAnomalies Int?
  inspectionCompliance Float?
  criticalAssetRiskIndex Float?
  status      String?   // 'normal', 'warning', 'critical'
  createdAt   DateTime @default(now())
}
